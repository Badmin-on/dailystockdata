# ğŸš€ YoonStock Pro - ì£¼ê°€ ë°ì´í„° ìˆ˜ì§‘ ì™„ì „ ê°€ì´ë“œ

**ëª©ì **: 1,788ê°œ ì „ì²´ ê¸°ì—…ì˜ 120ì¼ì¹˜ ì£¼ê°€ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ìˆ˜ì§‘
**í˜„ì¬ ìƒíƒœ**: 19ê°œ ê¸°ì—…ë§Œ ìˆ˜ì§‘ë¨ (1.1%)
**ëª©í‘œ**: 1,788ê°œ ê¸°ì—… (100%) - 18ë°°ì¹˜ ì‹¤í–‰
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 30-40ë¶„

---

## ğŸ“‹ ì „ì²´ í”„ë¡œì„¸ìŠ¤ (9ë‹¨ê³„)

```
âœ… STEP 1: í˜„ì¬ ìƒíƒœ ë°±ì—… ë° ìŠ¤ëƒ…ìƒ· Â·Â·Â·Â·Â·Â·Â·Â· ì™„ë£Œ
âœ… STEP 2: ìˆ˜ì§‘ ì „ ê²€ì¦ Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· ì™„ë£Œ
âœ… STEP 3: ë°°ì¹˜ ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸ ì¤€ë¹„ Â·Â·Â·Â·Â·Â·Â·Â·Â· ì™„ë£Œ
ğŸ‘‰ STEP 4: í…ŒìŠ¤íŠ¸ ìˆ˜ì§‘ (1ê°œ ë°°ì¹˜) Â·Â·Â·Â·Â·Â·Â·Â·Â· [ì§€ê¸ˆ ì—¬ê¸°]
   STEP 5: ì „ì²´ ë°°ì¹˜ ìˆ˜ì§‘ (18ë°°ì¹˜) Â·Â·Â·Â·Â·Â·Â·Â· ëŒ€ê¸° ì¤‘
   STEP 6: ìˆ˜ì§‘ ì™„ë£Œ í›„ ê²€ì¦ Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· ëŒ€ê¸° ì¤‘
   STEP 7: ì¤‘ë³µ ë°ì´í„° ì •ë¦¬ Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· ëŒ€ê¸° ì¤‘
   STEP 8: View ê°±ì‹  Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· ëŒ€ê¸° ì¤‘
   STEP 9: ìµœì¢… ê²€ì¦ ë° ë¶„ì„ Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â· ëŒ€ê¸° ì¤‘
```

---

## ğŸ¯ STEP 4: í…ŒìŠ¤íŠ¸ ìˆ˜ì§‘ (í•„ìˆ˜!)

ì „ì²´ ìˆ˜ì§‘ ì „ì— **ë°˜ë“œì‹œ** 1ê°œ ë°°ì¹˜ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.

### **ë°©ë²• 1: PowerShell (ê¶Œì¥)**

```powershell
# PowerShellì„ ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰
cd C:\alexDB\yoonstock-web

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
.\scripts\test-single-batch.ps1
```

### **ë°©ë²• 2: Git Bash**

```bash
cd /c/alexDB/yoonstock-web

bash scripts/test-single-batch.sh
```

### **ì˜ˆìƒ ê²°ê³¼**

```json
{
  "success": true,
  "batch": 1,
  "total_batches": 18,
  "has_more": true,
  "next_batch": 2,
  "companies_processed": 100,
  "success_count": 12000,  // 100ê°œ ê¸°ì—… Ã— 120ì¼
  "error_count": 0,
  "skipped_count": 0,
  "duration_seconds": 55
}
```

### **í…ŒìŠ¤íŠ¸ ì„±ê³µ ì¡°ê±´**

- âœ… HTTP 200 ì‘ë‹µ
- âœ… `success: true`
- âœ… `success_count > 0`
- âœ… `error_count`ê°€ ë‚®ìŒ (< 10%)

**âš ï¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ**: ì„œë²„ ë¡œê·¸ í™•ì¸ í›„ ë¬¸ì œ í•´ê²°

---

## ğŸš€ STEP 5: ì „ì²´ ë°°ì¹˜ ìˆ˜ì§‘ (ë³¸ê²© ìˆ˜ì§‘)

í…ŒìŠ¤íŠ¸ ì„±ê³µ í›„ ì „ì²´ 18ë°°ì¹˜ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

### **ë°©ë²• 1: PowerShell (ê¶Œì¥)**

```powershell
# ì „ì²´ ë°°ì¹˜ ìˆ˜ì§‘ (ìë™ ì§„í–‰ë¥  í‘œì‹œ)
.\scripts\collect-prices-safe.ps1
```

**ì˜µì…˜ ì‚¬ìš©**:
```powershell
# íŠ¹ì • ë²”ìœ„ë§Œ ìˆ˜ì§‘
.\scripts\collect-prices-safe.ps1 -StartBatch 1 -EndBatch 10

# ëŒ€ê¸° ì‹œê°„ ì¡°ì • (ê¸°ë³¸ 60ì´ˆ)
.\scripts\collect-prices-safe.ps1 -WaitSeconds 30
```

### **ë°©ë²• 2: ìˆ˜ë™ ì‹¤í–‰ (curl)**

```bash
# Windows Git Bash / Linux / macOS
for i in {1..18}; do
  echo "ë°°ì¹˜ $i ìˆ˜ì§‘ ì¤‘..."
  curl "http://localhost:3000/api/collect-stock-prices/batch?batch=$i"
  echo ""

  if [ $i -lt 18 ]; then
    echo "60ì´ˆ ëŒ€ê¸° ì¤‘..."
    sleep 60
  fi
done
```

### **ì‹¤í–‰ ì¤‘ í™”ë©´**

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   YoonStock Pro - ì£¼ê°€ ë°ì´í„° ë°°ì¹˜ ìˆ˜ì§‘ ì‹œì‘     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š ìˆ˜ì§‘ ë²”ìœ„: ë°°ì¹˜ 1 ~ 18
ğŸ“¦ ë°°ì¹˜ë‹¹ ê¸°ì—… ìˆ˜: 100ê°œ
ğŸ“ ë¡œê·¸ íŒŒì¼: collection-log-20251011-120000.txt
â±ï¸  ë°°ì¹˜ ê°„ ëŒ€ê¸°: 60ì´ˆ

ì§„í–‰ë¥ : [==========----------] 50% (9/18)

[2025-10-11 12:15:30] ğŸ“¦ ë°°ì¹˜ 9 ìˆ˜ì§‘ ì‹œì‘ (ì‹œë„ 1/3)
[2025-10-11 12:16:25] âœ… ë°°ì¹˜ 9 ì™„ë£Œ: ì„±ê³µ 12000ê°œ, ì‹¤íŒ¨ 0ê°œ
[2025-10-11 12:16:25] â³ 60ì´ˆ ëŒ€ê¸° ì¤‘...
```

### **ì˜ˆìƒ ì†Œìš” ì‹œê°„**

- ë°°ì¹˜ë‹¹: ì•½ 1-2ë¶„ (ìˆ˜ì§‘ + ëŒ€ê¸°)
- ì „ì²´ 18ë°°ì¹˜: **30-40ë¶„**

### **ì¤‘ë‹¨ ë° ì¬ê°œ**

**Ctrl+Cë¡œ ì¤‘ë‹¨ ê°€ëŠ¥**. ì¤‘ë‹¨ í›„ ì¬ê°œ:

```powershell
# ë°°ì¹˜ 10ë¶€í„° ì¬ê°œ
.\scripts\collect-prices-safe.ps1 -StartBatch 10 -EndBatch 18
```

---

## ğŸ“Š STEP 6: ìˆ˜ì§‘ ì™„ë£Œ í›„ ê²€ì¦

ì „ì²´ ìˆ˜ì§‘ ì™„ë£Œ í›„ ë°ì´í„° í’ˆì§ˆì„ ê²€ì¦í•©ë‹ˆë‹¤.

```powershell
# ìë™ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
.\scripts\post-collection-validation.ps1
```

### **ê²€ì¦ í•­ëª©**

1. âœ… **ìˆ˜ì§‘ ì „/í›„ ë¹„êµ**
   - ì£¼ê°€ ë°ì´í„°: 32,425ê±´ â†’ ~214,560ê±´ ì˜ˆìƒ
   - ì£¼ê°€ ë³´ìœ  ê¸°ì—…: 19ê°œ â†’ ~1,700ê°œ ì˜ˆìƒ

2. âœ… **ëª©í‘œ ë‹¬ì„±ë¥ **
   - ëª©í‘œ: 1,788ê°œ ê¸°ì—… (100%)
   - ì‹¤ì œ: ê³„ì‚°ë¨ (95% ì´ìƒ ê¶Œì¥)

3. âœ… **ë°ì´í„° í’ˆì§ˆ**
   - í‰ê·  ì£¼ê°€ ë°ì´í„°: 120ì¼ ì´ìƒ
   - 120ì¼ ì¤€ë¹„ ê¸°ì—…: ~1,400ê°œ ì´ìƒ

4. âœ… **íˆ¬ì ë¶„ì„ ê°€ëŠ¥ ì—¬ë¶€**
   - can_analyze_investments: true

### **ìˆ˜ë™ ê²€ì¦ (ì„ íƒì‚¬í•­)**

```powershell
# í˜„ì¬ ìƒíƒœ í™•ì¸
$response = Invoke-WebRequest http://localhost:3000/api/data-status
$response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 10

# ë˜ëŠ” ëª¨ë‹ˆí„°ë§ í˜ì´ì§€ í™•ì¸
start http://localhost:3000/monitor
```

---

## ğŸ”§ STEP 7: ì¤‘ë³µ ë°ì´í„° ì •ë¦¬ (ì„ íƒì‚¬í•­)

ëŒ€ë¶€ë¶„ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ë§Œ, í™•ì¸ì´ í•„ìš”í•œ ê²½ìš°:

```sql
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰

-- 1. ì¤‘ë³µ ë°ì´í„° í™•ì¸
SELECT company_id, date, COUNT(*) as dup_count
FROM daily_stock_prices
GROUP BY company_id, date
HAVING COUNT(*) > 1;

-- 2. ì¤‘ë³µ ì œê±° (í•„ìš” ì‹œ)
DELETE FROM daily_stock_prices a
USING daily_stock_prices b
WHERE a.id < b.id
  AND a.company_id = b.company_id
  AND a.date = b.date;
```

**âš ï¸ ì£¼ì˜**: ì¼ë°˜ì ìœ¼ë¡œ `UPSERT` ë¡œì§ìœ¼ë¡œ ìë™ ì²˜ë¦¬ë˜ë¯€ë¡œ ë¶ˆí•„ìš”í•  ê°€ëŠ¥ì„± ë†’ìŒ

---

## ğŸ”„ STEP 8: View ê°±ì‹  (í•„ìˆ˜!)

ìˆ˜ì§‘ ì™„ë£Œ í›„ **ë°˜ë“œì‹œ** Materialized Viewë¥¼ ê°±ì‹ í•´ì•¼ íˆ¬ì ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### **ë°©ë²• 1: API í˜¸ì¶œ**

```powershell
# PowerShell
Invoke-WebRequest -Method POST `
  -Uri "http://localhost:3000/api/refresh-views" `
  -Headers @{"Authorization"="Bearer $env:CRON_SECRET"}
```

```bash
# Bash
curl -X POST http://localhost:3000/api/refresh-views \
  -H "Authorization: Bearer $CRON_SECRET"
```

### **ë°©ë²• 2: ëª¨ë‹ˆí„°ë§ í˜ì´ì§€**

1. http://localhost:3000/monitor ì ‘ì†
2. **"ğŸ”„ View ê°±ì‹ "** ë²„íŠ¼ í´ë¦­
3. ì™„ë£Œ ë©”ì‹œì§€ í™•ì¸

### **ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 10-30ì´ˆ

---

## âœ… STEP 9: ìµœì¢… ê²€ì¦ ë° ë¶„ì„

ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ ìµœì¢… í™•ì¸í•©ë‹ˆë‹¤.

### **1. ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ í™•ì¸**

```
http://localhost:3000/monitor
```

**í™•ì¸ ì‚¬í•­**:
- âœ… ì´ ê¸°ì—… ìˆ˜: 1,788ê°œ
- âœ… ì£¼ê°€ ë°ì´í„°: ~214,560ê±´
- âœ… ì£¼ê°€ ë³´ìœ  ê¸°ì—…: ~1,700ê°œ (95%+)
- âœ… 120ì¼ ì¤€ë¹„: ~1,400ê°œ (80%+)

### **2. íˆ¬ì ê¸°íšŒ ë¶„ì„ í…ŒìŠ¤íŠ¸**

```
http://localhost:3000/opportunities
```

**í™•ì¸ ì‚¬í•­**:
- âœ… Sê¸‰/Aê¸‰ íˆ¬ì ê¸°íšŒ í‘œì‹œë¨
- âœ… ì»¨ì„¼ì„œìŠ¤ ì ìˆ˜ ê³„ì‚°ë¨
- âœ… ì´ê²©ë„ ì ìˆ˜ ê³„ì‚°ë¨
- âœ… í•„í„°ë§ ë° ì •ë ¬ ì‘ë™

### **3. API í…ŒìŠ¤íŠ¸**

```powershell
# íˆ¬ì ê¸°íšŒ Top 10 ì¡°íšŒ
$response = Invoke-WebRequest "http://localhost:3000/api/investment-opportunities?limit=10"
$data = $response.Content | ConvertFrom-Json
$data.data | Format-Table name, investment_score, investment_grade
```

---

## ğŸ“ ë¡œê·¸ ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### **ë¡œê·¸ íŒŒì¼ ìœ„ì¹˜**

```
C:\alexDB\yoonstock-web\collection-log-YYYYMMDD-HHMMSS.txt
data-status-before-collection.json
data-status-after-collection.json
```

### **ë¡œê·¸ í™•ì¸**

```powershell
# ìµœì‹  ë¡œê·¸ í™•ì¸
Get-ChildItem collection-log-*.txt | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | Get-Content -Tail 50
```

### **ì¼ë°˜ì ì¸ ë¬¸ì œ ë° í•´ê²°**

#### **ë¬¸ì œ 1: ì„œë²„ ì‘ë‹µ ì—†ìŒ**

```powershell
# ì„œë²„ ì¬ì‹œì‘
npm run dev
```

#### **ë¬¸ì œ 2: ì—°ì† ì‹¤íŒ¨ (3ë²ˆ ì´ìƒ)**

- ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
- Supabase ìƒíƒœ í™•ì¸ (Supabase Dashboard)
- Rate Limiting í™•ì¸ (ëŒ€ê¸° ì‹œê°„ ì¦ê°€: `-WaitSeconds 120`)

#### **ë¬¸ì œ 3: ì¼ë¶€ ë°°ì¹˜ë§Œ ì„±ê³µ**

```powershell
# ì‹¤íŒ¨í•œ ë°°ì¹˜ë§Œ ì¬ì‹¤í–‰
.\scripts\collect-prices-safe.ps1 -StartBatch 10 -EndBatch 12
```

#### **ë¬¸ì œ 4: ì¤‘ë³µ ë°ì´í„° ë°œìƒ**

```sql
-- SQL Editorì—ì„œ ì¤‘ë³µ ì œê±°
DELETE FROM daily_stock_prices a
USING daily_stock_prices b
WHERE a.id < b.id
  AND a.company_id = b.company_id
  AND a.date = b.date;
```

---

## ğŸ¯ ì„±ê³µ ê¸°ì¤€ ì²´í¬ë¦¬ìŠ¤íŠ¸

### **ë°ì´í„° ìˆ˜ì§‘**
- [ ] í…ŒìŠ¤íŠ¸ ë°°ì¹˜ ì„±ê³µ (ë°°ì¹˜ 1)
- [ ] ì „ì²´ 18ë°°ì¹˜ ì‹¤í–‰ ì™„ë£Œ
- [ ] ë¡œê·¸ íŒŒì¼ì— ì˜¤ë¥˜ ì—†ìŒ
- [ ] ì£¼ê°€ ë³´ìœ  ê¸°ì—…: â‰¥ 1,700ê°œ (95%+)
- [ ] í‰ê·  ì£¼ê°€ ë°ì´í„°: â‰¥ 120ì¼

### **ë°ì´í„° í’ˆì§ˆ**
- [ ] ì¤‘ë³µ ë°ì´í„° ì—†ìŒ
- [ ] NULL ê°’ ìµœì†Œí™”
- [ ] ìµœì‹  ë‚ ì§œ: 2025-10-10 (ë˜ëŠ” ìµœê·¼)

### **ì‹œìŠ¤í…œ ìƒíƒœ**
- [ ] Materialized View ê°±ì‹  ì™„ë£Œ
- [ ] íˆ¬ì ë¶„ì„ ê°€ëŠ¥ ìƒíƒœ
- [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ì •ìƒ í‘œì‹œ

### **ê¸°ëŠ¥ ê²€ì¦**
- [ ] `/monitor` í˜ì´ì§€ ì •ìƒ ì‘ë™
- [ ] `/opportunities` í˜ì´ì§€ ë°ì´í„° í‘œì‹œ
- [ ] í•„í„°ë§ ë° ì •ë ¬ ì‘ë™
- [ ] Sê¸‰/Aê¸‰ íˆ¬ì ê¸°íšŒ í‘œì‹œ

---

## ğŸ’¡ Pro Tips

### **íš¨ìœ¨ì ì¸ ìˆ˜ì§‘**

1. **ì•¼ê°„ ì‹¤í–‰ ê¶Œì¥**: ë„¤íŠ¸ì›Œí¬ ì•ˆì •ì , 30-40ë¶„ ì†Œìš”
2. **ëª¨ë‹ˆí„°ë§ í˜ì´ì§€ ì‹¤ì‹œê°„ í™•ì¸**: http://localhost:3000/monitor
3. **ë¡œê·¸ íŒŒì¼ ë³´ê´€**: ë¬¸ì œ ë°œìƒ ì‹œ ë¶„ì„ ìš©ë„

### **ë°ì´í„° ê´€ë¦¬**

1. **ì¼ì¼ ìë™ ìˆ˜ì§‘**: Vercel Cron (í‰ì¼ 20:00 KST)
2. **ìˆ˜ë™ ë³´ì •**: íŠ¹ì • ê¸°ì—… ëˆ„ë½ ì‹œ ê°œë³„ ìˆ˜ì§‘
3. **ì£¼ê¸°ì  ê²€ì¦**: ì£¼ 1íšŒ ë°ì´í„° í’ˆì§ˆ í™•ì¸

### **ì„±ëŠ¥ ìµœì í™”**

1. **ë³‘ë ¬ ìˆ˜ì§‘ ë¶ˆê°€**: API Rate Limiting ì£¼ì˜
2. **ëŒ€ê¸° ì‹œê°„ ì¡°ì •**: ë„¤íŠ¸ì›Œí¬ ìƒíƒœì— ë”°ë¼ 30-120ì´ˆ
3. **ë°°ì¹˜ í¬ê¸° ê³ ì •**: 100ê°œ ê¶Œì¥ (ë³€ê²½ ë¶ˆê°€)

---

## ğŸš€ ë¹ ë¥¸ ì‹¤í–‰ ëª…ë ¹ ìš”ì•½

```powershell
# 1. í…ŒìŠ¤íŠ¸ ìˆ˜ì§‘
.\scripts\test-single-batch.ps1

# 2. ì „ì²´ ìˆ˜ì§‘ (30-40ë¶„)
.\scripts\collect-prices-safe.ps1

# 3. ê²€ì¦
.\scripts\post-collection-validation.ps1

# 4. View ê°±ì‹ 
Invoke-WebRequest -Method POST http://localhost:3000/api/refresh-views

# 5. ê²°ê³¼ í™•ì¸
start http://localhost:3000/monitor
```

---

## ğŸ“ ì§€ì›

- **ë¬¸ì„œ**: `DATA_ANALYSIS_REPORT.md`
- **GitHub Issues**: https://github.com/Badmin-on/dailystockdata/issues
- **ëª¨ë‹ˆí„°ë§**: http://localhost:3000/monitor

---

**ì‘ì„±ì¼**: 2025-10-11
**ë²„ì „**: 1.0.0
**ì‘ì„±ì**: Claude Code (Architect + Analyzer Persona)
